<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="index.css">
  <script src="https://d3js.org/d3.v4.min.js"></script>

  <title>Document</title>
</head>
<body>

  <svg class="line-chart">

  </svg>

  <script>
    var api = 'https://api.coindesk.com/v1/bpi/historical/close.json?start=2019-12-31&end=2020-04-01';
    
    function parseData(data) {
      var arr = [];
      for (var i in data.bpi) {
        arr.push({
          date: new Date(i), //date
          value: +data.bpi[i] //convert string to number
        });
      }
      return arr;
    }

    function drawChart(data) {
      var svgWidth = 600, svgHeight = 400;
      var margin = { top: 20, right: 20, bottom: 30, left: 50 };
      var width = svgWidth - margin.left - margin.right;
      var height = svgHeight - margin.top - margin.bottom;
      var svg = d3.select('svg').attr("width", svgWidth).attr("height", svgHeight);

      var g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      // add scales to chart
      var x = d3.scaleTime().rangeRound([0, width]);
      var y = d3.scaleLinear().rangeRound([height, 0]);

      //create line
      var line = d3.line()
        .x(function(d) {
          return x(d.date)
        })
        .y(function(d) {
          return y(d.value)
        });
      
      x.domain(d3.extent(data, function(d) {
        return d.date
      }));
      
      y.domain(d3.extent(data, function(d) {
        return d.value
      }));

      //append X axis
      g.append("g").attr("transform", "translate(0," + height + ")").call(d3.axisBottom(x)).select(".domain").remove();

      //append y axis
      g.append("g").call(d3.axisLeft(y)).append("text").attr("fill", "#000").attr("transform", "rotate(-90)").attr("y", 6).attr("dy", "0.71em").attr("text-anchor", "end").text("Price ($)");

      // append bars
      // g.selectAll("bar").data(data)
      // .enter()
      // .append("rect")
      // .style("fill", "blue")
      // .attr("x", function(d) { return x(d.date); })
      // .attr("width", x.rangeBand())
      // .attr("y", function(d) { return y(d.value); })
      // .attr("height", function(d) { return height - y(d.value); });
      
      //append path
      g.append("path").datum(data)
      .attr("fill", "none")
      .attr("stroke", "steelblue")
      .attr("stroke-linejoin", "round")
      .attr("stroke-linecap", "round")
      .attr("stroke-width", 1.5)
      .attr("d", line);
    }

    document.addEventListener("DOMContentLoaded", function(event) {
      fetch(api)
      .then(function(response) {
        return response.json();
      }).then(function(data) {
        var parsedData = parseData(data);
        drawChart(parsedData);
      })
    });

  </script>
</body>
</html>